{
  "hash": "6e6c637e23467de94bf0d2eb2b7787b2",
  "result": {
    "markdown": "---\ntitle: \"Strengthen your no-code apps with R code: appsheet 0.1.0\"\nauthor: Samuel Calderon\ndate: '2023-10-02'\ncategories:\n  - \"rweekly\"\n  - \"package\"\n  - \"no-code\"\n  - \"appsheet\"\nknitr: \n  opts_chunk: \n    comment: \"#>\"\n    class-output: \"text-muted\"\n    class-error: \"text-danger\"\n---\n\n\nThis blog post serves two purposes: 1) To explain why no-code apps might be useful to you, 2) To announce the release of [`{appsheet}`](https://calderonsamuel.github.io/appsheet/) 0.1.0 to the world. \n\nThis new package allows you to interact with Google's Appsheet API to read, add, edit and delete data from AppSheet tables. \n\nSo, let's understand why no-code apps might be important for an R user.\n\n# Why no-code apps?\n\nMaybe the first thing that comes to your mind as an R user/developer when talking about app development is, naturally, [shiny](https://www.rstudio.com/products/shiny/). It is true that the shiny ecosystem is big, keeps growing, and offers a wide variety of customization for your apps/dashboards, but for small to medium-sized businesses, it might not be the cheapest or easiest option.\n\nIn those types of businesses, you'll often find data stored in spreadsheets that get fed manually (row by row) or by some kind of digital form. This is true not just for these kinds of businesses but for small offices in big organizations too, especially outside the tech world. When attempting to upgrade the data collection flow, many of these organizations opt for no-code alternatives. While I consider this a pretty good solution for data collection and data storage, I believe that the data analysis process might benefit from using our favorite programming language: R.\n\nTo be 100% transparent, the creation of this package comes from my experience in a big governmental organization, where the IT department didn't want to deploy a custom-made shiny app and didn't even allow my team to deploy it on a shinyapps.io free-tier instance. Hey, that's life. So, for new projects, I decided to use a no-code alternative that took advantage of the cloud storage provided for the email service: Google's Appsheet.\n\n![Sometimes, easier is easier](iq.png)\n\nAppsheet allows you to build apps pretty fast based on data you already have. You can feed it a Google Sheet (and other data storage formats) and it will generate Views and Forms for your app users to interact with. With some knowledge of relational databases, you can get a pretty decent looking app for desktop and mobile devices that you can customize in just a few hours of work. \n\n# Why R with no-code apps\n\nWhere it still has plenty of room to grow is in the data analysis space. While it is possible to have tables, histograms, pie charts, donut charts, column plots, scatter plots, and even maps, the only aggregation options are count, average, min and max. If you want to see the value of a specific column, you **have** to hover on it. \n\n![In this plot you can only see the value of the \"Devuelto\" column](hover.png)\n\nWhat if instead of a plot you want a table that shows the same information (count based on a column)? You can't have it. I mean, you can have it if you implement [some ultra complicated automation workflow](https://www.googlecloudcommunity.com/gc/AppSheet-Q-A/Creating-a-summary-table/m-p/234056#M16542), but at that point, why don't you just use R?\n\nThat's why I created this package. I wanted a way to interact with Appsheet's API with my favorite language, taking advantage of the power of Quarto and the tidyverse for data cleaning, visualization and reporting. Now, anyone who wants to do the same thing doesn't need to start from scratch.\n\n# The four basic operations {#operations}\n\nThe first step is to [Enable the API for cloud-based service communication](https://support.google.com/appsheet/answer/10105769?hl=en&ref_topic=10105767&sjid=7476345061548698748-SA). Once this is done you should have:\n\n1. The App ID. Use it in the `appId` argument of `appsheet()` or via the `APPSHEET_APP_ID` environmental variable.\n2. The Application Access Key. Use it in the `access_key` argument of `appsheet()` or via the `APPSHEET_APP_ACCESS_KEY` environmental variable.\n\nThe `appsheet()` function looks for both environmental variables by default.\n\nThe API only exposes really basic operations: read, add, edit and remove table records. It all starts with loading the package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(appsheet)\n```\n:::\n\n\n\n## Read a table\n\nThe first argument of `appsheet()` is a table name. By default, `appsheet()` will use the \"Find\" action, which reads all the rows. The following code is the equivalent of using `appsheet(tableName = \"Driver\", Action = \"Find\")`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nappsheet(\"Driver\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.text-muted}\n#> # A tibble: 7 × 7\n#>   `_RowNumber` Key      `Driver Name` Photo           Email `Phone Number` Jobs \n#>   <chr>        <chr>    <chr>         <chr>           <chr> <chr>          <chr>\n#> 1 2            70608c66 Driver 1      Driver_Images/… driv… 1-206-555-1000 db9e…\n#> 2 3            261fadec Driver 2      Driver_Images/… driv… 1-206-555-1001 36a4…\n#> 3 4            525982c5 Driver 3      Driver_Images/… driv… 1-206-555-1002 1db9…\n#> 4 5            90eb1244 Driver 4      Driver_Images/… driv… 1-206-555-1003 e367…\n#> 5 6            ddb26f78 Driver 5      Driver_Images/… driv… 1-206-555-1004 5420…\n#> 6 7            29671cfb Driver 6      Driver_Images/… driv… 1-206-555-1005 98ed…\n#> 7 8            7a6fafca Driver 7      Driver_Images/… driv… 1-206-555-1006 0b64…\n```\n:::\n:::\n\n\nWhen the action is \"Find\", you can take advantage of the `Selector` argument of `ash_properties()`, which can use some AppSheet internal functions to narrow the output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nappsheet(\n\ttableName = \"Driver\", \n\tProperties = ash_properties(Selector = 'Filter(Driver, [Key] = \"70608c66\")')\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.text-muted}\n#> # A tibble: 1 × 7\n#>   `_RowNumber` Key      `Driver Name` Photo           Email `Phone Number` Jobs \n#>   <chr>        <chr>    <chr>         <chr>           <chr> <chr>          <chr>\n#> 1 2            70608c66 Driver 1      Driver_Images/… driv… 1-206-555-1000 db9e…\n```\n:::\n:::\n\n\nThe \"Find\" action is probably the one you'll find yourself spending most time with\n\n## Add records to a table \n\nThe \"Add\" action allows to add one or multiple records to a table. You must provide `Rows`, which can be a dataframe with the same column names as the specified table. You don't need to provide all the columns to be successful, but can't exclude the ones *required* by your app. Also, don't try to add the `_RowNumber`(or `Row ID` when using an AppsSheet database), as it is generated internally.\n\nAn \"Add\" action returns a data.frame with the added rows when successful.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrow_key <- paste0(sample(letters, 8), collapse = \"\") # to be reused \n\nappsheet(\n\ttableName = \"Driver\",\n\tAction = \"Add\",\n\tRows = tibble::tibble(\n\t\tKey = row_key, # required in app logic\n\t\t`Email` = \"driverXX@company.com\" # required in app logic\n\t) \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.text-muted}\n#> # A tibble: 1 × 7\n#>   `_RowNumber` Key      `Driver Name` Photo Email           `Phone Number` Jobs \n#>   <chr>        <chr>    <chr>         <chr> <chr>           <chr>          <chr>\n#> 1 9            odlahjfg \"\"            \"\"    driverXX@compa… \"\"             \"\"\n```\n:::\n:::\n\n\n## Update records from a table\n\nThe \"Edit\" action allow to update values from one or multiple records from a table, it also can target multiple columns. This one also requires the `Rows` argument. Again, you can't use the `_RowNumber` column (but in this one you can use the `Row ID` generated by an Appsheet database).\n\nAn \"Edit\" action returns a data.frame with the whole content of the updated rows when successful.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nappsheet(\n\ttableName = \"Driver\",\n\tAction = \"Edit\",\n\tRows = tibble::tibble(\n\t\tKey = row_key,\n\t\t`Driver Name` = \"Some name\",\n\t\tPhoto = \"some/path.jpg\"\n\t) \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.text-muted}\n#> # A tibble: 1 × 7\n#>   `_RowNumber` Key      `Driver Name` Photo         Email   `Phone Number` Jobs \n#>   <chr>        <chr>    <chr>         <chr>         <chr>   <chr>          <chr>\n#> 1 9            odlahjfg Some name     some/path.jpg driver… \"\"             \"\"\n```\n:::\n:::\n\n\n\n## Delete records from a table\n\nThe \"Delete\" action allows to delete one or multiple records from a table. This one also requires the `Rows` argument. Again, you can't use the `_RowNumber` column (but in this one you can use the `Row ID` generated by an Appsheet database).\n\nA \"Delete\" action returns a data.frame with the deleted rows when successful.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nappsheet(\n\ttableName = \"Driver\",\n\tAction = \"Delete\",\n\tRows = tibble::tibble(\n\t\tKey = row_key\n\t) \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.text-muted}\n#> # A tibble: 1 × 7\n#>   `_RowNumber` Key      `Driver Name` Photo         Email   `Phone Number` Jobs \n#>   <chr>        <chr>    <chr>         <chr>         <chr>   <chr>          <chr>\n#> 1 9            odlahjfg Some name     some/path.jpg driver… \"\"             \"\"\n```\n:::\n:::\n\n\n# Automate reporting with Github actions\n\nTo take the advantage of the API, you can automate the creation of your reports. [Github Actions](https://github.com/features/actions) is a pretty popular choice to set a temporary computing environment for different tasks. Here, I show you just the necessary for you to create your report with Quarto and send it via email. At this point you should already have your [Appsheet enviromental variables](#operations).\n\nThe next thing you need is to have your project set up as a Github repo. If you don't know how to do this, you can check the following chapter in [Happy Git and Github for the useR](https://happygitwithr.com/existing-github-last). To be extra safe, you can configure your project to use [`{renv}`](https://rstudio.github.io/renv/articles/renv.html) for a reproducible environment. \n\nNext, you need a quarto document with the contents of your report to be rendered. Inside this report is where you should use `{appsheet}` and your favorite data processing and visualization packages. \n\nAt the same directory level, you can have an R script where you render the report (`quarto::render()` ftw) and send it via email with `{blastula}`. For that, be sure to check the article on [Sending Email Using SMTP](https://pkgs.rstudio.com/blastula/articles/sending_using_smtp.html). \n\nFinally, you should set up a workflow YAML file in the `.github/workflows/` directory in your repository. Here you have a simplified example when your script is called `script.R`:\n\n```yaml\non: workflow_dispatch\nname: Generate and send report\n\njobs:\n  \n  reporting:\n    \n    runs-on: ubuntu-latest\n    \n    env:\n      # Environmental variables\n      GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}\n      APPSHEET_APP_ID: ${{ secrets.APPSHEET_APP_ID }}\n      APPSHEET_APP_ACCESS_KEY: ${{ secrets.APPSHEET_APP_ACCESS_KEY }}\n      BLASTULA_EMAIL_CREDS: ${{ secrets.BLASTULA_EMAIL_CREDS }}\n    \n    steps:\n      \n      # Checkout the git repo\n      - uses: actions/checkout@v3\n      \n      # Set up pandoc - I just keep it to be safe\n      - uses: r-lib/actions/setup-pandoc@v2\n      \n      # Install R\n      - uses: r-lib/actions/setup-r@v2\n      \n      # Install quarto    \n      - uses: quarto-dev/quarto-actions/setup@v2\n      \n      # Install the necessary packages with renv\n      - uses: r-lib/actions/setup-renv@v2\n      \n      - name: Run rendering script\n        run: |\n          Rscript script.R\n```\n\nOf course, there are ways of optimizing your workflow file and to strengthen the security of your script. Another thing to consider is that you have a limit of 2000 minutes a month of compute time for private repos in the free version (no limit on public repos). \n\nHere you have a repo where I set up an automatic reporting schedule with all the steps described before: <https://github.com/ddc-research/auto-pronabi>. It takes around 2 minutes for the job to complete and it's totally free and safe.\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}